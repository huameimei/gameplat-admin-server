<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gameplat.admin.mapper.GameTransferInfoMapper">

    <insert id="saveOrUpdate" parameterType="com.gameplat.model.entity.game.GameTransferInfo">
        insert into `game_transfer_info` (
        member_id,
        <if test="account != null and account != ''">account,</if>
        <if test="orderNo != null and orderNo != ''">order_no,</if>
        <if test="platformCode != null and platformCode != ''">platform_code,</if>
        <if test="lastBalance != null and lastBalance != ''">last_balance,</if>
        create_time
        ) values (
        #{memberId}
        <if test="account != null and account != ''">#{account},</if>
        <if test="orderNo != null and orderNo != ''">#{orderNo},</if>
        <if test="platformCode != null and platformCode != ''">#{platformCode},</if>
        <if test="lastBalance != null and lastBalance != ''">#{lastBalance},</if>
        sysdate() )
        ON DUPLICATE KEY UPDATE
        <if test='orderNo != null and orderNo != ""'>order_no = #{orderNo},</if>
        update_time = sysdate(),
        last_balance = #{lastBalance}
    </insert>

    <select id="getAllGameBalance" resultType="java.math.BigDecimal">
        select ifnull(sum(last_balance), 0) as allGameBalance
        from game_transfer_info
        where platform_code != 'SELF'
    </select>

</mapper>
