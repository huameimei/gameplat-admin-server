<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gameplat.admin.mapper.activity.MemberPrizeDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gameplat.admin.model.domain.activity.MemberPrize">
        <id column="prize_id" property="prizeId" />
        <result column="prize_type" property="prizeType" />
        <result column="prize_level" property="prizeLevel" />
        <result column="prize_icon" property="prizeIcon" />
        <result column="prize_name" property="prizeName" />
        <result column="ticket_yard" property="ticketYard" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="remark" property="remark" />
        <result column="status" property="status" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        prize_id, prize_type, prize_level, prize_icon, prize_name, ticket_yard, create_by, create_time, update_by, update_time, remark,status
    </sql>

    <!-- 根据转盘查询奖品 -->
	<select id="findPrizeList" resultMap="BaseResultMap">
		SELECT <include refid="Base_Column_List" /> from member_prize t where 1=1
		<if test="prizeName != null and prizeName != 'null' and prizeName != ''">
		  and t.`prize_name` LIKE CONCAT('%',#{prizeName},'%')
		</if>
		<if test="prizeType != null">
		  and t.`prize_type` LIKE CONCAT('%',#{prizeType},'%')
		</if>
		<if test="prizeLevel != null">
		  and t.`prize_level` LIKE CONCAT('%',#{prizeLevel},'%')
		</if>
		<if test="status != null">
		  and t.`status` = #{status}
		</if>
	</select>

	<!-- 新增奖品 -->
	<insert id="savePrize">
		INSERT INTO member_prize(
		<if test="prizeId != null">prize_id,</if>
		<if test="prizeType != null">prize_type,</if>
		<if test="prizeLevel != null">prize_level,</if>
		<if test="prizeIcon != null">prize_icon,</if>
		<if test="prizeName != null">prize_name,</if>
		<if test="ticketYard != null">ticket_yard,</if>
		<if test="status != null">status,</if>
		<if test="createBy != null">create_by,</if>
		<if test="createTime != null">create_time</if>
		)
		VALUES(
		<if test="prizeId != null">#{prizeId},</if>
		<if test="prizeType != null">#{prizeType},</if>
		<if test="prizeLevel != null">#{prizeLevel},</if>
		<if test="prizeIcon != null">#{prizeIcon},</if>
		<if test="prizeName != null">#{prizeName},</if>
		<if test="ticketYard != null">#{ticketYard},</if>
		<if test="status != null">#{status},</if>
		<if test="createBy != null">#{createBy},</if>
		<if test="createTime != null">#{createTime}</if>
		)
	</insert>

	<!-- 修改奖品 -->
	<update id="updatePrize">
			UPDATE member_prize
			<set>
				<if test="prizeType != null">prize_type = #{prizeType},</if>
				<if test="prizeLevel != null">prize_level = #{prizeLevel},</if>
				<if test="prizeIcon != null">prize_icon = #{prizeIcon},</if>
				<if test="prizeName != null">prize_name = #{prizeName},</if>
				<if test="ticketYard != null">ticket_yard = #{ticketYard},</if>
				<if test="status != null">status = #{status},</if>
				<if test="updateBy != null">update_by = #{updateBy},</if>
				update_time = sysdate()
			</set>
			WHERE prize_id = #{prizeId}
	</update>

	<!-- 删除奖品 -->
	<delete id="deletePrize">
		DELETE from member_prize where prize_id in
		<foreach collection="list" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
	</delete>

	<select id="findActivityPrizeList" resultType="com.gameplat.admin.model.vo.activity.MemberActivityPrizeVO">
		SELECT a.id id,a.prize_chance prizeChance,a.prize_repertory prizeRepertory,a.give_amount giveAmount,p.prize_id prizeId,
		p.prize_type prizeType, p.prize_level prizeLevel, p.prize_icon prizeIcon,p.prize_name prizeName,p.ticket_yard ticketYard FROM member_prize p
		LEFT JOIN member_activity_prize a
		ON p.prize_id=a.activity_prize_id
		WHERE p.`status`=1
		<if test="type != null">
		  and a.`type` = #{type}
		</if>
		<if test="type != null">
		  and a.`activity_id` = #{activityId}
		</if>
		<if test="isGroup != null">
		  and a.`is_group` = #{isGroup}
		</if>
		<if test="groupId != null">
		  and a.`group_id` = #{groupId}
		</if>
	</select>

	<select id="findPrizeById" resultType="com.gameplat.admin.model.vo.activity.MemberActivityPrizeVO" parameterType="java.lang.Integer">
		SELECT <include refid="Base_Column_List" />
		FROM member_prize
		WHERE 1=1
		<if test="prizeId != null">
			and prize_id = #{prizeId}
		</if>
	</select>
</mapper>
