<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gameplat.admin.mapper.activity.MemberPrizeWinningDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.live.cloud.backend.model.activity.entity.MemberPrizeWinning">
        <id column="winning_id" property="winningId" />
        <result column="user_id" property="userId" />
        <result column="username" property="username" />
        <result column="activity_id" property="activityId" />
        <result column="activity_type" property="activityType" />
        <result column="prize_id" property="prizeId" />
        <result column="prize_type" property="prizeType" />
        <result column="prize_name" property="prizeName" />
        <result column="prize_level" property="prizeLevel" />
        <result column="num" property="num" />
        <result column="is_get" property="isGet" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        winning_id, user_id, username, activity_id, activity_type, prize_id, prize_type, prize_name, prize_level, num, is_get, create_by, create_time, update_by, update_time, remark
    </sql>

        <select id="findList" resultMap ="BaseResultMap">
         select
		<include refid="Base_Column_List" />
		from member_prize_winning
		<where>

			<if test="activityId!=null">
				and activity_id=#{activityId}
			</if>

			<if test="activityType!=null">
				and activity_type=#{activityType}
			</if>

			<if test="userId!=null">
				and user_id=#{userId}
			</if>

			<if test="paramsValue.beginTime != null and paramsValue.beginTime != ''">
		        AND date_format(create_time,'%y%m%d') &gt;= date_format(#{paramsValue.beginTime},'%y%m%d')
		    </if>

		    <if test="paramsValue.endTime != null and paramsValue.endTime != ''">
		        AND date_format(create_time,'%y%m%d') &lt;= date_format(#{paramsValue.endTime},'%y%m%d')
		    </if>
		</where>
    </select>

    <insert id="insert">
    insert into
    member_prize_winning
    (user_id, username, activity_id, activity_type, prize_id, prize_type, prize_name, prize_level, num, is_get, create_by, create_time)
    values
    (#{userId},#{username},#{activityId},#{activityType},#{prizeId},#{prizeType},#{prizeName},#{prizeLevel},#{num},#{isGet},#{createBy},sysdate())
    </insert>

	<insert id="insertBatch">
		insert into
		member_prize_winning
		(winning_id,user_id, username, activity_id, activity_type, prize_id, prize_type,prize_name, prize_level, num, is_get, create_by, create_time)
		values
		<foreach collection="list" item="obj" separator=",">
			(#{obj.winningId},#{obj.userId},#{obj.username},#{obj.activityId},#{obj.activityType},#{obj.prizeId},#{obj.prizeType},#{obj.prizeName},#{obj.prizeLevel},#{obj.num},#{obj.isGet},#{obj.createBy},sysdate())
		</foreach>
	</insert>

	<select id="findMemberTurntableWinRecordList" resultType="com.gameplat.admin.model.vo.activity.MemberTurntableWinRecordVO">
		select username,prize_name as prizeName,IFNULL(num,0) num,DATE_FORMAT(create_time, '%m-%d') createTime
		from member_prize_winning where activity_id=#{turntableId} and activity_type=2 ORDER BY create_time desc LIMIT 50
	</select>

</mapper>
