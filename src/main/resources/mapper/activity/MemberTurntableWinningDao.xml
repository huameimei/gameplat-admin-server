<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gameplat.admin.mapper.activity.MemberTurntableWinningDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.gameplat.admin.model.domain.activity.MemberTurntableWinning">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="username" property="username" />
        <result column="activity_id" property="activityId" />
        <result column="turntable_id" property="turntableId" />
        <result column="prize_id" property="prizeId" />
        <result column="prize_type" property="prizeType" />
        <result column="prize_name" property="prizeName" />
        <result column="prize_level" property="prizeLevel" />
        <result column="num" property="num" />
        <result column="is_get" property="isGet" />
        <result column="create_by" property="createBy" />
        <result column="create_time" property="createTime" />
        <result column="update_by" property="updateBy" />
        <result column="update_time" property="updateTime" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, user_id, username, activity_id, turntable_id, prize_id, prize_type,prize_name,prize_level,num,is_get, create_by, create_time, update_by, update_time, remark
    </sql>

    <select id="findList" resultMap ="BaseResultMap">
         select
		<include refid="Base_Column_List" />
		from member_turntable_winning
		<where>
			<if test="userId!=null">
				and user_id=#{userId}
			</if>

			<if test="userId!=null">
				and user_id=#{userId}
			</if>

			<if test="paramsValue.beginTime != null and paramsValue.beginTime != ''">
		        AND date_format(create_time,'%y%m%d') &gt;= date_format(#{paramsValue.beginTime},'%y%m%d')
		    </if>

		    <if test="paramsValue.endTime != null and paramsValue.endTime != ''">
		        AND date_format(create_time,'%y%m%d') &lt;= date_format(#{paramsValue.endTime},'%y%m%d')
		    </if>
		</where>
    </select>

    <insert id="insert">
    insert into
    member_turntable_winning
    (id,user_id, username, activity_id, turntable_id, prize_id, prize_type,prize_name,prize_level, num, create_by, create_time)
    values(#{id},#{userId},#{username},#{activityId},#{turntableId},#{prizeId},#{prizeType},#{prizeName},#{prizeLevel},#{num},#{createBy},sysdate())
    </insert>

	<select id="findMemberTurntableWinRecordList" resultType="com.gameplat.admin.model.vo.activity.MemberTurntableWinRecordVO">
		select username,prize_name as prizeName,IFNULL(num,0) num,DATE_FORMAT(create_time, '%m-%d') createTime
		from member_turntable_winning where turntable_id=#{turntableId} ORDER BY create_time desc LIMIT 50
	</select>
</mapper>
